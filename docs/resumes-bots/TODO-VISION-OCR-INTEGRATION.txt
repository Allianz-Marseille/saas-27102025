================================================================================
  TODO â€” Mise en Å“uvre Vision API OCR (point 4 : intÃ©gration dans le flux des bots)
================================================================================

RÃ©fÃ©rence : docs/resumes-bots/FIREBASE-ML-UTILITE-ET-MISE-EN-OEUVRE.txt
Objectif : intÃ©grer lâ€™OCR (Google Cloud Vision) dans le pipeline des bots
           Nina, Sinistro et Bob pour amÃ©liorer lâ€™analyse des images/PDF.


--- PRÃ‰REQUIS (points 1 Ã  3 du doc) -------------------------------------------

âœ… 1. Activer Cloud Vision API
      - Google Cloud Console â†’ projet liÃ© Ã  Firebase
      - Activer "Cloud Vision API"

âœ… 2. Credentials
      - CrÃ©er ou rÃ©utiliser un compte de service (JSON)
      - RÃ´le : Cloud Vision API User (ou Ã©quivalent)
      - DÃ©finir GOOGLE_APPLICATION_CREDENTIALS (local + dÃ©ploiement)
        ou config via Secret Manager / variables dâ€™env selon lâ€™hÃ©bergeur

âœ… 3. DÃ©pendance et module partagÃ©
      - @google-cloud/vision dÃ©jÃ  dans le projet
      - Module crÃ©Ã© : lib/assistant/vision-ocr.ts
      - Exposer une fonction dâ€™OCR : entrÃ©e buffer ou base64, sortie texte
        (documentTextDetection option pour Sinistro ; fallback "" si Ã©chec)
      - GÃ©rer les erreurs (API indisponible, quota, image invalide) et
        prÃ©voir un fallback sans OCR si Ã©chec


--- POINT 4 : INTÃ‰GRATION DANS LE FLUX DES BOTS --------------------------------

  NINA (SecrÃ©taire â€” documents, PDF scannÃ©s, photos)
  --------------------------------------------------
âœ… 4.1  Dans la route chat ou le traitement des fichiers (lib/assistant/),
         dÃ©tecter les entrÃ©es image/PDF (ou premiÃ¨res pages en images).
âœ… 4.2  Avant envoi au LLM : appeler lâ€™OCR sur chaque image / page PDF
         concernÃ©e.
âœ… 4.3  Envoyer le texte extrait au LLM :
         - soit en plus de lâ€™image (contexte enrichi),
         - soit Ã  la place de lâ€™image pour les PDF scannÃ©s (meilleurs
           rÃ©sumÃ©s/analyses).
âœ… 4.4  Adapter le prompt ou le format du message pour indiquer que le
         contenu est issu dâ€™un document (OCR) si pertinent.
ğŸ”² 4.5  Tester : upload PDF scannÃ© + photo de document â†’ vÃ©rifier qualitÃ©
         des rÃ©sumÃ©s/analyses.


  SINISTRO (Sinistres â€” constats amiables)
  ----------------------------------------
âœ… 4.6  Pour chaque image de constat amiable reÃ§ue dans le chat, appeler
         documentTextDetection() pour conserver la structure (blocs, paragraphes).
âœ… 4.7  Injecter le texte structurÃ© dans le contexte du prompt Sinistro
         (ou en entrÃ©e structurÃ©e dÃ©diÃ©e â€œcontenu du constatâ€).
âœ… 4.8  Sâ€™assurer que le prompt Sinistro prÃ©cise dâ€™utiliser ce contenu
         pour la qualification (IRSA, IRSI, droit commun) et lâ€™analyse.
ğŸ”² 4.9  Tester : envoi dâ€™une image de constat â†’ vÃ©rifier extraction puis
         qualitÃ© de la qualification et du sourÃ§age.


  BOB (SantÃ© & PrÃ©voyance â€” attestations, liasses, 2035)
  ------------------------------------------------------
âœ… 4.10 Optionnel : pour les uploads image (attestations, liasses, 2035),
         appeler lâ€™OCR avant ou en parallÃ¨le de lâ€™envoi au LLM.
âœ… 4.11 Ajouter le texte extrait au contexte ou au message utilisateur
         pour que Bob puisse sâ€™appuyer sur des champs prÃ©cis (chiffres,
         noms de caisses, etc.).
ğŸ”² 4.12 Tester : upload image de liasse / 2035 â†’ vÃ©rifier que les rÃ©ponses
         citent correctement les donnÃ©es extraites.


--- OPTIONNEL ET FINALISATION --------------------------------------------------

ğŸ”² 4.13 (Optionnel) Ã‰tiquetage dâ€™images : si utile (ex. dÃ©tecter â€œdocumentâ€,
         â€œtableauâ€), appeler labelDetection() et utiliser les labels pour
         router le traitement (Nina / Sinistro).
âœ… 4.14 Limiter les appels Vision (coÃ»ts, quotas) : pas dâ€™OCR sur toutes
         les images si le message nâ€™en a pas besoin ; Ã©ventuellement
         limite par message (ex. max N images en OCR).
âœ… 4.15 Documenter : mettre Ã  jour ORGANISATION-NINA.txt, ORGANISATION-SINISTRO.txt
         et ORGANISATION-BOB.txt avec les chemins du module OCR et le
         flux (quand lâ€™OCR est appelÃ©, fallback si Ã©chec).


================================================================================
  Ordre suggÃ©rÃ© : 1 â†’ 2 â†’ 3 â†’ 4.1â€“4.5 (Nina) â†’ 4.6â€“4.9 (Sinistro) â†’ 4.10â€“4.12 (Bob)
================================================================================
